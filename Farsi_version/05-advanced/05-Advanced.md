
---

<div dir="rtl" align="right">

# ⚙️ درس ۵ — دستورات پیشرفته Git (برگشت، اصلاح و نجات پروژه)

---

## 🎯 هدف درس
در این درس یاد می‌گیری:
- چطور اشتباهات رو اصلاح کنی (`reset`, `revert`, `amend`)  
- چطور تغییراتت رو موقت نگه داری (`stash`)  
- چطور از commit خاصی استفاده کنی (`cherry-pick`)  
- چطور commit خراب‌کننده رو پیدا کنی (`bisect`)  
- چطور commit‌های گمشده رو برگردونی (`reflog`)  

---

## 🧠 مقدمه
Git فقط برای ذخیره نسخه‌ها نیست —  
بلکه یه «ماشین زمان» هوشمنده که حتی بعد از خراب شدن پروژه، می‌تونه بهت کمک کنه برگردی به نقطه امن 🔥  

---

## 🧩 ۱) اصلاح آخرین commit (`--amend`)
گاهی commit زدی ولی یادت رفته توضیح درست بنویسی یا فایل جدیدی اضافه کنی.  
به‌جای ساختن commit جدید، می‌تونی آخرین commit رو اصلاح کنی.

### مثال:
```bash
git commit -m "اضافه کردن فایل login"
# حالا می‌فهمی یه فایل رو جا انداختی
git add style.css
git commit --amend
````

حالا فایل `style.css` هم داخل همون commit قبلی ثبت میشه.
اگر فقط می‌خوای پیام commit رو عوض کنی:

```bash
git commit --amend -m "اضافه کردن فرم لاگین و استایل"
```

> ⚠️ توجه: از `--amend` روی commit‌هایی که قبلاً push کردی استفاده نکن؛ چون تاریخچه رو تغییر میده.

---

## 💾 ۲) ذخیره موقت تغییرات (`stash`)

فرض کن وسط کار هستی ولی باید سریع شاخه عوض کنی، بدون اینکه commit بزنی.

```bash
git stash push -m "در حال کار روی بخش navbar"
```

الان تغییراتت ذخیره شدن و پوشه پروژه تمیز شده.

برای دیدن stashes:

```bash
git stash list
```

نمونه خروجی:

```
stash@{0}: On main: در حال کار روی بخش navbar
```

برای برگردوندن:

```bash
git stash apply stash@{0}
```

یا:

```bash
git stash pop
```

که بعد از برگردوندن، اون مورد از لیست هم پاک میشه.

برای حذف دستی stash:

```bash
git stash drop stash@{0}
```

---

## 🔙 ۳) برگردوندن commit اشتباه (`reset` و `revert`)

### 🧱 الف) `git reset`

اگر فقط می‌خوای commit محلی رو پاک یا ویرایش کنی (قبل از push):

```bash
git reset --soft HEAD~1   # commit حذف میشه ولی فایل‌ها در stage می‌مونن
git reset --mixed HEAD~1  # commit حذف میشه و فایل‌ها unstaged می‌شن
git reset --hard HEAD~1   # همه چیز پاک میشه (خطرناک!)
```

### 🛡️ ب) `git revert`

اگر commit اشتباه رو **push کردی** و باید اون رو در تاریخچه برگردونی بدون حذف،
از `revert` استفاده کن:

```bash
git revert <commit-hash>
```

این دستور یه commit جدید می‌سازه که اثر commit اشتباه رو خنثی می‌کنه.

---

## 🍒 ۴) برداشتن commit خاص از شاخه دیگر (`cherry-pick`)

فرض کن در شاخه `feature-x` یه commit داری که می‌خوای همونو بیاری داخل شاخه `main` بدون merge کامل.

```bash
git checkout main
git cherry-pick <commit-hash>
```

📘 فقط همون commit انتخاب‌شده به شاخه فعلی اضافه میشه.
ابزاری عالی برای زمانی که فقط یه تغییر خاص رو لازم داری.

---

## 🧮 ۵) پیدا کردن commit خراب‌کننده (`bisect`)

گاهی پروژه‌ت خراب میشه و نمی‌دونی از کجا.
Git می‌تونه با روش "جستجوی دودویی" commit مقصر رو پیدا کنه 😎

### گام‌ها:

```bash
git bisect start
git bisect bad                # وضعیت فعلی (خراب)
git bisect good <commit-id>   # یه commit قدیمی که سالم بوده
```

Git به‌صورت خودکار بین این دو نقطه جابجا میشه و ازت می‌پرسه هر بار good یا bad بود.
وقتی commit مقصر پیدا شد:

```bash
git bisect reset
```

---

## 🧩 ۶) دیدن تاریخچه حرکات HEAD (`reflog`)

حتی اگه چیزی رو پاک کرده باشی، Git ردش رو نگه می‌داره!
با `reflog` می‌تونی برگردی به هر وضعیت قبلی 😍

```bash
git reflog
```

خروجی مثلاً:

```
b2a9d3c HEAD@{0}: commit: اصلاح فایل main.js
d1c7f44 HEAD@{1}: checkout: moving from feature-x to main
a3e12d1 HEAD@{2}: commit: اضافه کردن فرم ورود
```

حالا می‌تونی برگردی به هر نقطه:

```bash
git checkout HEAD@{2}
```

> 💡 حتی اگر با `reset --hard` چیزی رو پاک کرده باشی، با `reflog` معمولاً می‌تونی نجاتش بدی.

---

## 🧪 تمرین درس ۵

1️⃣ چند commit متوالی بساز.

2️⃣ یکی از commit‌ها رو با `git reset --soft HEAD~1` حذف کن.

3️⃣ همون commit رو با `git reflog` پیدا و برگردون.

4️⃣ تغییراتی بنویس، بدون commit، و با `git stash` ذخیره‌ش کن.

5️⃣ شاخه رو عوض کن و بعد `git stash pop` کن تا تغییرات برگردن.

6️⃣ یکی از commit‌های شاخه دیگه رو با `git cherry-pick` بیار.

7️⃣ تمرین bisect رو امتحان کن: یکی از commit‌ها رو به‌عنوان خراب علامت بزن.

8️⃣ تمام خروجی‌ها و مراحل رو در فایل `lesson5-advanced.txt` بنویس.

---

## ⚠️ هشدارهای حرفه‌ای

| مورد         | توصیه                                                             |
| ------------ | ----------------------------------------------------------------- |
| reset --hard | فقط در شاخه‌های محلی استفاده کن؛ ممکنه داده رو برای همیشه حذف کنه |
| amend        | فقط قبل از push استفاده کن                                        |
| rebase       | تاریخچه رو تمیز نگه می‌داره ولی خطرناک برای شاخه‌های اشتراکی      |
| stash        | برای نگهداری موقت عالیه، ولی فراموش نکن پاکش کنی                  |
| reflog       | آخرین امید برای نجات داده‌های پاک‌شده 😅                          |

---

## 🧾 خلاصه (Cheat Sheet)

| دستور                       | کاربرد                        |
| --------------------------- | ----------------------------- |
| `git commit --amend`        | اصلاح آخرین commit            |
| `git stash push -m "msg"`   | ذخیره موقت تغییرات            |
| `git stash pop`             | بازگرداندن آخرین stash        |
| `git reset --soft HEAD~1`   | حذف commit بدون حذف تغییرات   |
| `git revert <hash>`         | ساخت commit معکوس (ایمن)      |
| `git cherry-pick <hash>`    | آوردن commit خاص از شاخه دیگر |
| `git bisect start/good/bad` | پیدا کردن commit خراب‌کننده   |
| `git reflog`                | نمایش تاریخچه حرکات HEAD      |

---

## 🚀 مرحله بعد

تا اینجا تو یه توسعه‌دهنده‌ی حرفه‌ای Git شدی 💪
در درس بعدی یاد می‌گیری چطور از امکانات امنیتی Git استفاده کنی:
**امضای کامیت‌ها (GPG/SSH Signing)**، **مدیریت فایل‌های بزرگ (LFS)**، و **Submodules** برای پروژه‌های تو در تو.

</div>
```